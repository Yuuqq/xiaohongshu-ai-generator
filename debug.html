<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è°ƒè¯•é¡µé¢ - å°çº¢ä¹¦AIå›¾ç‰‡ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-title {
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #6750A4;
            padding-bottom: 5px;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        button {
            background: #6750A4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5a4093;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ å°çº¢ä¹¦AIå›¾ç‰‡ç”Ÿæˆå™¨ - è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-panel">
        <h2 class="debug-title">ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</h2>
        <div id="systemStatus"></div>
        <button onclick="checkSystemStatus()">æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
    </div>

    <div class="debug-panel">
        <h2 class="debug-title">æ¨¡æ¿ç³»ç»Ÿæµ‹è¯•</h2>
        <div id="templateStatus"></div>
        <button onclick="testTemplateSystem()">æµ‹è¯•æ¨¡æ¿ç³»ç»Ÿ</button>
        <button onclick="loadTemplatesManually()">æ‰‹åŠ¨åŠ è½½æ¨¡æ¿</button>
    </div>

    <div class="debug-panel">
        <h2 class="debug-title">é¢„è§ˆç³»ç»Ÿæµ‹è¯•</h2>
        <div id="previewStatus"></div>
        <button onclick="testPreviewSystem()">æµ‹è¯•é¢„è§ˆç³»ç»Ÿ</button>
        <button onclick="simulateStep2()">æ¨¡æ‹Ÿæ­¥éª¤2æ“ä½œ</button>
    </div>

    <div class="debug-panel">
        <h2 class="debug-title">æ§åˆ¶å°æ—¥å¿—</h2>
        <div id="consoleLog" class="debug-info" style="height: 200px; overflow-y: auto;"></div>
        <button onclick="clearConsoleLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script>
        // é‡å†™console.logæ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToConsoleLog(message, type = 'log') {
            const logDiv = document.getElementById('consoleLog');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsoleLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsoleLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToConsoleLog(args.join(' '), 'warn');
        };

        function clearConsoleLog() {
            document.getElementById('consoleLog').innerHTML = '';
        }

        function addStatus(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.textContent = message;
            container.appendChild(status);
        }

        function clearStatus(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function checkSystemStatus() {
            clearStatus('systemStatus');
            
            // æ£€æŸ¥å…¨å±€å¯¹è±¡
            const modules = [
                'Utils', 'templateManager', 'previewSystem', 
                'contentOptimizer', 'visualGenerator', 'uiManager'
            ];
            
            modules.forEach(module => {
                if (window[module]) {
                    addStatus('systemStatus', `âœ“ ${module} å·²åŠ è½½`, 'success');
                } else {
                    addStatus('systemStatus', `âœ— ${module} æœªåŠ è½½`, 'error');
                }
            });
            
            // æ£€æŸ¥DOMå…ƒç´ 
            const elements = ['templateGrid', 'nextStep2', 'toneGrid'];
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    addStatus('systemStatus', `âœ“ å…ƒç´  ${id} å­˜åœ¨`, 'success');
                } else {
                    addStatus('systemStatus', `âœ— å…ƒç´  ${id} ä¸å­˜åœ¨`, 'error');
                }
            });
        }

        function testTemplateSystem() {
            clearStatus('templateStatus');
            
            if (!window.templateManager) {
                addStatus('templateStatus', 'æ¨¡æ¿ç®¡ç†å™¨æœªåŠ è½½', 'error');
                return;
            }
            
            addStatus('templateStatus', `æ¨¡æ¿æ•°é‡: ${window.templateManager.templates?.length || 0}`, 'success');
            
            if (window.templateManager.templates) {
                window.templateManager.templates.forEach((template, index) => {
                    addStatus('templateStatus', `æ¨¡æ¿ ${index + 1}: ${template.name} (${template.id})`, 'success');
                });
            }
            
            // æµ‹è¯•æ¨¡æ¿é€‰æ‹©
            if (window.templateManager.templates && window.templateManager.templates.length > 0) {
                const firstTemplate = window.templateManager.templates[0];
                window.templateManager.selectTemplate(firstTemplate.id);
                addStatus('templateStatus', `æµ‹è¯•é€‰æ‹©æ¨¡æ¿: ${firstTemplate.name}`, 'success');
            }
        }

        function loadTemplatesManually() {
            clearStatus('templateStatus');
            
            if (window.templateManager) {
                window.templateManager.loadTemplates().then(() => {
                    addStatus('templateStatus', 'æ¨¡æ¿é‡æ–°åŠ è½½å®Œæˆ', 'success');
                    testTemplateSystem();
                }).catch(error => {
                    addStatus('templateStatus', `æ¨¡æ¿åŠ è½½å¤±è´¥: ${error.message}`, 'error');
                });
            } else {
                addStatus('templateStatus', 'æ¨¡æ¿ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
            }
        }

        function testPreviewSystem() {
            clearStatus('previewStatus');
            
            if (!window.previewSystem) {
                addStatus('previewStatus', 'é¢„è§ˆç³»ç»ŸæœªåŠ è½½', 'error');
                return;
            }
            
            const stepData = window.previewSystem.getStepData();
            addStatus('previewStatus', `å½“å‰æ­¥éª¤: ${window.previewSystem.currentStep}`, 'success');
            addStatus('previewStatus', `å†…å®¹: ${stepData.content || 'æ— '}`, stepData.content ? 'success' : 'warning');
            addStatus('previewStatus', `å£å»: ${stepData.tone || 'æ— '}`, stepData.tone ? 'success' : 'warning');
            addStatus('previewStatus', `æ¨¡æ¿: ${stepData.template?.name || 'æ— '}`, stepData.template ? 'success' : 'warning');
            addStatus('previewStatus', `æ ‡ç­¾: ${stepData.customTags?.length || 0} ä¸ª`, 'success');
        }

        function simulateStep2() {
            clearStatus('previewStatus');
            
            if (!window.previewSystem) {
                addStatus('previewStatus', 'é¢„è§ˆç³»ç»ŸæœªåŠ è½½', 'error');
                return;
            }
            
            // æ¨¡æ‹Ÿè®¾ç½®å†…å®¹
            window.previewSystem.setStepData({
                content: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å†…å®¹ï¼Œç”¨äºéªŒè¯æ­¥éª¤2çš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚'
            });
            
            // æ¨¡æ‹Ÿé€‰æ‹©å£å»
            window.previewSystem.setStepData({
                tone: 'friendly'
            });
            
            // æ¨¡æ‹Ÿé€‰æ‹©æ¨¡æ¿
            if (window.templateManager && window.templateManager.templates && window.templateManager.templates.length > 0) {
                window.previewSystem.setStepData({
                    template: window.templateManager.templates[0]
                });
            }
            
            // éªŒè¯æ­¥éª¤2
            const isValid = window.previewSystem.validateStep2();
            addStatus('previewStatus', `æ­¥éª¤2éªŒè¯ç»“æœ: ${isValid ? 'é€šè¿‡' : 'å¤±è´¥'}`, isValid ? 'success' : 'error');
            
            testPreviewSystem();
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkSystemStatus();
                testTemplateSystem();
                testPreviewSystem();
            }, 2000);
        });
    </script>

    <!-- åŠ è½½ä¸»è¦è„šæœ¬ -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/prompt-engine.js"></script>
    <script src="assets/js/templates.js"></script>
    <script src="assets/js/content-optimizer.js"></script>
    <script src="assets/js/visual-generator.js"></script>
    <script src="assets/js/preview-system.js"></script>
    <script src="assets/js/performance-optimizer.js"></script>
    <script src="assets/js/ui.js"></script>
    <script src="assets/js/generator.js"></script>
    <script src="assets/js/app.js"></script>
</body>
</html>
